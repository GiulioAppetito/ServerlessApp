<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="static/style.css">
    <title>Cloudy Days - Previsioni Meteo</title>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        var daysOfWeek = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"];
        var today = new Date();
        var dayOfWeek = daysOfWeek[today.getDay()];

        var dayOfWeekElement = document.getElementById('day-of-week');
        dayOfWeekElement.textContent = "-" + dayOfWeek;
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var launchButton = document.getElementById('login_btn');

        launchButton.addEventListener('click', function () {

            var usernameform = document.getElementById('usernameform');
            var passwordform = document.getElementById('passwordform');
            var username = usernameform.value;
            var password = passwordform.value;

            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username: username, password: password })
            })
                .then(response => response.json()).then(data => {
                    if (data.correct) {
                        var usernamelab = document.getElementById('lab3');
                        usernamelab.innerHTML = data.username;
                        usernamelab.style.display = "block";

                        var button1 = document.getElementById("login_btn");
                        var button2 = document.getElementById("logout_btn");
                        button1.style.display = "none";
                        button2.style display = "block";
                        button2.style.float = "right";

                        // login form
                        var form1 = document.getElementById("lab1");
                        var form2 = document.getElementById("lab2");
                        var form3 = document.getElementById("usernameform");
                        var form4 = document.getElementById("passwordform");
                        form1.style.display = "none";
                        form2.style.display = "none";
                        form3.style.display = "none";
                        form4.style.display = "none";
                    }
                });

        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        var launchButton = document.getElementById('logout_btn');
        var usernamelab = document.getElementById('lab3');
        var username = usernamelab.value;

        launchButton.addEventListener('click', function () {

            fetch('/logout' + username)

            usernamelab.style.display = "none";
            var button1 = document.getElementById("login_btn");
            var button2 = document.getElementById("logout_btn");
            button1.style.display = "block";
            button2.style.display = "none";
            button1.style.float = "right";

            // login form
            var form1 = document.getElementById("lab1");
            var form2 = document.getElementById("lab2");
            var form3 = document.getElementById("usernameform");
            var form4 = document.getElementById("passwordform");

            form1.style.display = "block";
            form2.style.display = "block";
            form3.style.display = "block";
            form4.style.display = "block";
            form4.style.float = "right";
            form3.style.float = "right";
            form3.value = "";
            form4.value = "";

        });
    });


</script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var searchButton = document.getElementById('search_btn');
            searchButton.addEventListener('click', function () {
                var cityName = document.getElementById('cityform').value;
                var url = 'https://0kx6tvog8k.execute-api.us-east-1.amazonaws.com/dev'; // Sostituisci con l'URL del tuo API Gateway

                fetch(url, {
                    method: 'POST',
                    body: JSON.stringify({ cityName: cityName }),
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                    .then(response => response.text())
                    .then(result => {
                        var data = JSON.parse(JSON.parse(result).body); // Analizza il corpo della risposta come JSON
                        // Estrarre i singoli campi dalla risposta JSON
                        var city = data.cityName;
                        var temp = data.temperature;
                        var humidity = data.humidity;
                        var weather = data.weather;

                        // Aggiorna gli elementi HTML con i dati estratti 
                        document.getElementById('cityName').textContent = city;
                        document.getElementById('temperature').textContent = temp + "°C";
                        document.getElementById('humidity').textContent = humidity + "%";
                        document.getElementById('weather').textContent = weather;

                        // Crea un nuovo oggetto Data
                        var dataCorrente = new Date();

                        // Ottieni la data corrente (formato: YYYY-MM-DD)
                        var data = dataCorrente.toISOString().slice(0, 10);

                        // Ottieni l'ora corrente (formato: HH:MM:SS)
                        var ora = dataCorrente.toTimeString().slice(0, 8);
                        document.getElementById('todayDateTime').textContent = data + ", " + ora;
                    })
                    .catch(error => console.error('Errore nella richiesta: ' + error));
            });

        });
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        var searchButton = document.getElementById('search_btn_forecast');
        searchButton.addEventListener('click', function () {
            var cityName = document.getElementById('city-search-forecast').value;
            var url = 'https://or8dml27g0.execute-api.us-east-1.amazonaws.com/dev'; // Sostituisci con l'URL del tuo API Gateway

            fetch(url, {
                method: 'POST',
                body: JSON.stringify({ cityName: cityName }),
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.statusCode === 200) {
                        var bodyData = JSON.parse(data.body); // Analizza il corpo JSON all'interno della risposta

                        if (Array.isArray(bodyData) && bodyData.length > 0) {
                            // Prendi i dati dalla prima previsione
                            var firstForecast = bodyData[0];
                            var city = firstForecast.cityName;
                            var temp = firstForecast.max_temperature;
                            var humidity = firstForecast.humidity;
                            var weather = firstForecast.weather;

                            // Aggiorna gli elementi HTML con i dati estratti
                            document.getElementById('cityName0').textContent = city;
                            document.getElementById('temperature0').textContent = temp + "°C";
                            document.getElementById('humidity0').textContent = humidity + "%";
                            document.getElementById('weather0').textContent = weather;
                        } else {
                            console.error('Nessuna previsione trovata nell\'array dei dati previsionali.');
                        }
                    } else {
                        console.error('La risposta ha restituito uno statusCode diverso da 200.');
                    }
                })
                .catch(error => console.error('Errore nella richiesta: ' + error));
        });
    });
</script>

    
</head>
<body>
    <header>
        <h1>Cloudy Days</h1>
        <section class="right-text">

            <div class="mb-3">
                <label id="lab1" for="inputUsername" class="form-label">Username:</label>
                <input class="form-control" type="text" id="usernameform" name="inputUsername" rows="1" required>
                <label id="lab2" for="InputPassword">Password:</label>
                <input class="form-control" type="password" id="passwordform" name="inputPassword" required>
            </div>

            <button class="rounded-button" id="login_btn">Login</button>

            <label id="lab3" class="form-label" style='display:none'>{{ username }}</label>

            <button class="rounded-button" id="logout_btn" style='display:none'>Logout</button>

        </section>
    </header>
    <section class="container-title">
        <div>
            <h2>Today</h2>
            <p>Check out today's weather.</p>
        </div>
        <form>
                <section>
                    <input class="form-control" placeholder="Insert city name" type="text" id="cityform" name="inputCity" rows="1" required>
                        <p>
                        <button class="rounded-button" type="button" id="search_btn">Search</button>
                        </p> 
                </section>
            
        </form>
    </section>
    <section class="weather-container">

        <div class="today-card">
            <h2>Today</h2>
            <b style="font-size: 25px" id="cityName"></b>
            <p>Last update: <span class="temperature" id="todayDateTime"></span></p>
            <img src="..\static\images\sun.png">
            <p>Temp: <span class="temperature" id="temperature"></span></p>
            <p>Humidity: <span class="temperature" id="humidity"></span></p>
            <p>Weather: <span class="temperature" id="weather"></span></p>
        </div>
        <div class="today-card">
            <p>Preferences</p>

        </div>

        <!-- Ripeti lo stesso modello per gli altri giorni della settimana -->
    </section>
    <section class="container-title">
        <h2>Forecast</h2>
        <p>Check out weather forecast for the next 7 days.</p>
        <form onsubmit="event.preventDefault();">
                <section>
                    <input class="form-control" placeholder="Insert city name" type="text" id="city-search-forecast" name="inputCity" rows="1" required>
                    <button class="rounded-button" type="button" id="search_btn_forecast">Search</button>
                </section>
            
        </form>
    </section>
    <section class="weather-container">
        <div class="day-card" id="lunedì">
            <h2 id='date0'></h2>
            <img src="..\static\images\storm.png" alt="Nome della città">
            <p>Max temp: <span class="temperature" id='max_temp0'></span></p>
            <p>Min temp: <span class="temperature" id='min_temp0'></span></p>
            <p>Wind speed: <span class="temperature" id='wind_speed0'></span></p>
            <p>Humidity: <span class="temperature" id='humidity0'></span></p>
            <p>Weather: <span class="temperature" id='weather0'></span></p>
        </div>
        <div class="day-card" id="'martedì">
            <h2>Martedì</h2>
            <img src="..\static\images\cloudy.png" alt="Nome della città">
            <p>Max temp: <span class="temperature">22°C</span></p>
        </div>
        <div class="day-card">
            <h2>Mercoledì</h2>
            <img src="..\static\images\sun.png" alt="Nome della città">
            <p>Max temp: <span class="temperature">24°C</span></p>
        </div>
        <div class="day-card">
            <h2>Giovedì</h2>
            <img src="..\static\images\cloudy.png" alt="Nome della città">
            <p>Max temp: <span class="temperature">25°C</span></p>
        </div>
        <div class="day-card">
            <h2>Venerdì</h2>
            <img src="..\static\images\storm.png" alt="Nome della città">
            <p>Max temp: <span class="temperature">25°C</span></p>
        </div>
        <div class="day-card">
            <h2>Sabato</h2>
            <img src="..\static\images\sun.png" alt="Nome della città">
            <p>Max temp: <span class="temperature">25°C</span></p>
        </div>
        <div class="day-card">
            <h2>Domenica</h2>
            <img src="..\static\images\cloudyrain.png" alt="Nome della città">
            <p>Max temp: <span class="temperature">25°C</span></p>
        </div>
        <!-- Ripeti lo stesso modello per gli altri giorni della settimana -->
    </section>
    <section class="container-title">
        <h2>Statistics</h2>
        <p>Check out weather statistics for the past 14 days.</p>
        <form>
                <section>
                    <input class="form-control" placeholder="Insert city name" type="text" id="city-search-past" name="inputCity" rows="1" required>{{ request.form['inputCity'] }}
                        <p>
                        <button class="rounded-button" type="button" onclick="callAPI()">Search</button>
                        </p> 
                </section>
            
        </form>
    </section>
    <section class="weather-container">
        <div class="stats-card">
            <p>Average temp: <span class="temperature">25°C</span></p>
            <p>Average humidity: <span class="temperature">40%</span></p>
            <p>Average temp: <span class="temperature">25°C</span></p>
            <p>Average temp: <span class="temperature">25°C</span></p>
        </div>
    </h1>
    </section>
    
    <footer>
        <p>&copy; 2023 Cloudy Days</p>
    </footer>
</body>
</html>
